<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Legendary: Game of Heroes deck suggester</title>
    <meta name="description" content="Legendary: Game of Heroes deck suggester">
    <meta name="author" content="Giero">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css">
    <link rel="stylesheet" href="css/style.css">

    <style type="text/css">
        .popover {
            color: #000
        }
    </style>
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                Legendary: Game of Heroes - deck suggester
            </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul id="page-nav" class="nav navbar-nav pull-right">
                <li role="presentation" class="dropdown-right active">
                    <a href="#team" class="pull-left">Your team</a>
                    <a href="#" class="dropdown-toggle pull-left" data-toggle="dropdown">
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu team-actions-menu">
                        <li><a href="#" id="team-save" data-action="save">Save team</a></li>
                        <li><a href="#" id="team-load" data-action="load">Load team</a></li>
                        <li><a href="#" id="team-delete" data-action="delete">Delete saved teams</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#" id="team-import" data-action="import">Import team</a></li>
                        <li><a href="#" id="team-export" data-action="export">Export team</a></li>
                    </ul>
                </li>
                <li role="presentation"><a href="#decks">Suggested decks</a></li>
                <li role="presentation"><a href="#heroes">List of heroes</a></li>
                <li role="presentation"><a href="#contact">Contact</a></li>
            </ul>
        </div>
    </div>
</nav>

<div id="app" class="container" role="main">
    <div class="row">
        <div class="tab-content" id="page-content">
            <div class="tab-pane fade active in" role="tabpanel" id="team">
                <team-adding-form></team-adding-form>
                <team-heroes-list></team-heroes-list>
            </div>
            <div class="tab-pane fade" role="tabpanel" id="decks">
                <computed-decks></computed-decks>
            </div>
            <div class="tab-pane fade" role="tabpanel" id="heroes">
                <p class="bg-danger" style="padding: 15px">
                    This list is based on <strong><a href="https://goo.gl/e2ql9O">this spreadsheet</a></strong> - feel free to update it, if something is missing.
                </p>
                <all-heroes-list></all-heroes-list>
            </div>
            <div class="tab-pane fade" role="tabpanel" id="contact">
                <p>Soon ;)</p>
            </div>
        </div>
    </div>
</div>

<template id="heroes-list">
    <section>
        <div>
            <ul :id="listId" class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a :href="'#' + listId + '-fire'">Fire ({{ counter.fire }})</a></li>
                <li role="presentation"><a :href="'#' + listId + '-water'">Water ({{ counter.water }})</a></li>
                <li role="presentation"><a :href="'#' + listId + '-earth'">Earth ({{ counter.earth }})</a></li>
                <li role="presentation"><a :href="'#' + listId + '-light'">Light ({{ counter.light }})</a></li>
                <li role="presentation"><a :href="'#' + listId + '-dark'">Dark ({{ counter.dark }})</a></li>
                <li role="presentation"><a :href="'#' + listId + '-all'">All ({{ counter.all }})</a></li>
            </ul>
        </div>

        <div class="tab-content" :id="listId + '-content'">
            <div class="tab-pane fade active in" role="tabpanel" :id="listId + '-fire'">
                <heroes-table affinity="Fire"></heroes-table>
            </div>
            <div class="tab-pane fade" role="tabpanel" :id="listId + '-water'">
                <heroes-table affinity="Water"></heroes-table>
            </div>
            <div class="tab-pane fade" role="tabpanel" :id="listId + '-earth'">
                <heroes-table affinity="Earth"></heroes-table>
            </div>
            <div class="tab-pane fade" role="tabpanel" :id="listId + '-light'">
                <heroes-table affinity="Light"></heroes-table>
            </div>
            <div class="tab-pane fade" role="tabpanel" :id="listId + '-dark'">
                <heroes-table affinity="Dark"></heroes-table>
            </div>
            <div class="tab-pane fade" role="tabpanel" :id="listId + '-all'">
                <heroes-table></heroes-table>
            </div>
        </div>
    </section>
</template>

<template id="heroes-table">
    <section>
        <div class="filters row">
            <div class="form-group col-sm-3">
                <label for="search-element">Hero name</label>
                <input v-model="searchKey" class="form-control" id="search-element" />
            </div>
        </div>

        <table class="table heroes-table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Attack</th>
                <th>Recovery</th>
                <th>Health</th>
                <th>Event Skills</th>
                <th>Defender Skill</th>
                <th>Counter Skill</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="hero in filteredHeroes" :data-hero-id="hero.id">
                <td>
                    {{ hero.name }} <span v-html="hero.rarityStarsHTML"></span>
                </td>
                <td><span class="hero-editable-stat" data-stat="attack">{{ hero.attack }}</span></td>
                <td><span class="hero-editable-stat" data-stat="recovery">{{ hero.recovery }}</span></td>
                <td><span class="hero-editable-stat" data-stat="health">{{ hero.health }}</span></td>
                <td>
                    <span class="label label-primary event-skill"
                          v-for="eventSkill in ['Slayer', 'Bounty Hunter', 'Commander']"
                          v-if="hero.eventSkills.hasOwnProperty(eventSkill)">
                        {{ eventSkill }} {{ hero.eventSkills[eventSkill] }}x
                    </span>
                </td>
                <td>{{ hero.defenderSkill }}</td>
                <td>{{ hero.counterSkill }}</td>
                <td>
                    <span class="glyphicon glyphicon-remove text-danger" style="cursor: pointer;" @click="removeHeroFromList"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </section>
</template>

<template id="team-adding-form">
    <div class="jumbotron">
        <form id="team-adding" role="form" method="post" class="form-horizontal" @submit="addHeroToTeam">
            <fieldset>
                <legend>Add hero to team</legend>
                <div class='form-group'>
                    <div class='col-sm-12'>
                        <select class="form-control selectpicker" id="team-hero-id" name="id" required title="Hero name" data-live-search="true">
                            <optgroup v-for="affinity in affinities" :label="affinity">
                                <option v-for="hero in heroes" v-if="hero.affinity == affinity" :value="hero.id"
                                        :data-content="hero.name + ' ' + hero.rarityStarsHTML"
                                >{{ hero.name }}
                                </option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-4">
                        <input type="number" class="form-control" id="team-hero-attack" name="attack" required placeholder="Attack"/>
                    </div>
                    <div class="col-sm-4">
                        <input type="number" class="form-control" id="team-hero-recovery" name="recovery" required placeholder="Recovery"/>
                    </div>
                    <div class="col-sm-4">
                        <input type="number" class="form-control" id="team-hero-health" name="health" required placeholder="Health"/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-4" v-for="(id, skill) in {'Slayer': 'slayer', 'Bounty Hunter': 'bounty-hunter', 'Commander': 'commander'}">
                        <select class="form-control selectpicker" :id="'team-hero-' + id" :name="'eventSkills['+skill+']'" :title="skill">
                            <option value=""></option>
                            <option value="2">2x</option>
                            <option value="3">3x</option>
                            <option value="4">4x</option>
                            <option value="5">5x</option>
                            <option value="7">7x</option>
                            <option value="10">10x</option>
                        </select>
                    </div>
                </div>
                <button id="add-to-team" class="btn btn-primary">Add to team</button>
                <button id="add-random-to-team" @click="addRandomHeroToTeam" class="btn btn-primary" title="Press Shift to add 10 heroes at once">
                    Add random hero to team (for tests)
                </button>
                <button id="clear-team" @click="clearTeam" class="btn btn-danger pull-right">Clear your team</button>
            </fieldset>
        </form>
    </div>
</template>

<template id="computed-decks">
    <section class="container">
        <div class="row">
            <div v-show="teamHeroes.heroes.length < 5">
                <span>Add some more heroes to your team</span>
            </div>
            <div v-show="teamHeroes.heroes.length >= 5" class="row" style="display: flex; align-items: center">
                <div class="col-sm-5">
                    <button id="calculate-decks" class="btn btn-primary" @click="calculateDecks">
                        <span>Calculate decks</span>
                        <br />
                        <small>(possible {{ possibilities.format(0, 3) }} decks in {{ (possibilities*5).format(0, 3) }} configurations (for every affinity))</small>
                    </button>
                    <button id="stop-calculations" style="display: none" class="btn btn-danger" @click="stopCalculations">Stop calculations</button>
                </div>

                <div class="col-sm-7">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Calculation options</h3>
                        </div>
                        <div class="panel-body row">
                            <div class="col-sm-6">

                                <div class="form-group">
                                    <label for="calculation-event-type">Enable event:</label>
                                    <select id="calculation-event-type" class="selectpicker" v-model="event">
                                        <option value="">None</option>
                                        <option value="Slayer">Slayer</option>
                                        <option value="Commander">Commander</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="calculation-counter-skill">Team counter skills:</label>
                                    <select id="calculation-counter-skill" class="selectpicker" v-model="counterSkills"
                                            multiple data-max-options="5" data-selected-text-format="count > 2">
                                        <option v-for="option in counterSkillsOptions">
                                            {{ option }}
                                        </option>
                                    </select>
                                    <span class="glyphicon glyphicon-info-sign text-info"
                                          data-toggle="popover"
                                          data-trigger="hover"
                                          data-placement="top"
                                          data-container="body"
                                          data-content="If you don't see some skill that means none of your team card has it."></span>
                                </div>
                                <div class="form-group">
                                    <label for="calculation-affinity">Limit opponent affinities:</label>
                                    <select id="calculation-affinity" class="selectpicker" v-model="affinitiesLimit"
                                            multiple data-max-options="5" data-selected-text-format="count > 2">
                                        <option v-for="option in affinityOptions">
                                            {{ option }}
                                        </option>
                                    </select>
                                    <span class="glyphicon glyphicon-info-sign text-info"
                                          data-toggle="popover"
                                          data-trigger="hover"
                                          data-placement="top"
                                          data-container="body"
                                          data-content="Limiting this will speed up your calculations."></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div v-for="(progress, affinity) in workersProgress" v-if="progress > -1 && progress < 100" class="progress">
                <div :class="progressClass[affinity]" role="progressbar" :style="'width: ' + progress + '%'">
                    {{affinity}}: {{ progress }}%
                </div>
            </div>
        </div>

        <div class="calculated-heroes-panel row panel panel-default" v-for="(decksByStat, affinity) in bestDecks" v-if="Object.keys(decksByStat).length !== 0">
            <div class="panel-heading">Against: {{ affinity }}</div>

            <div class="panel panel-body">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" :class="stat == 'attack' ? 'active' : ''" v-for="(deck, stat) in decksByStat">
                        <a :href="'#computed-' + affinity.replace(/ /g, '-') + '-' + stat" role="tab" data-toggle="tab">
                            {{ stat.replace(/_/g, ' ') }}
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade row" :class="stat == 'attack' ? 'in active' : ''"
                         :id="'computed-' + affinity.replace(/ /g, '-') + '-' + stat.replace(/ /g, '-')" v-for="(deck, stat) in decksByStat">

                        <div class="heroes-list col-sm-10">
                            <ul class="list-group">
                                <li class="list-group-item" v-for="(hero, key) in deck.heroes">
                                    <span :class="key === 0 ? 'text-danger': ''">
                                        {{ hero.name }} <span v-html="hero.rarityStarsHTML"></span>
                                        ({{ hero.affinity }} {{ hero.type }} {{ hero.species }}
                                        :: {{ hero.attack }}/{{ hero.recovery }}/{{ hero.health }})
                                        <span v-if="Object.keys(hero.eventSkills).length !== 0">
                                            <span v-if="hero.eventSkills.hasOwnProperty('Slayer')" class="label label-primary event-skill">
                                                Slayer {{ hero.eventSkills.Slayer }}x
                                            </span>

                                            <span v-if="hero.eventSkills.hasOwnProperty('Commander')" class="label label-primary event-skill">
                                                {{ hero.affinity }} Commander {{ hero.eventSkills.Commander }}x
                                            </span>
                                        </span>
                                    </span>
                                    <span v-if="key === 0"
                                          class="glyphicon glyphicon-info-sign text-info"
                                          data-toggle="popover"
                                          data-trigger="hover"
                                          :title="hero.leaderAbility.name"
                                          :data-content="hero.leaderAbility.description"></span>
                                </li>
                            </ul>
                        </div>

                        <div class="stats-list col-sm-2">
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <strong>score</strong>
                                    <span class="glyphicon glyphicon-info-sign text-info"
                                          data-toggle="popover"
                                          data-trigger="hover"
                                          data-placement="top"
                                          data-container="body"
                                          :data-content="'Sum of all heroes \'' + stat.replace(/_/g, ' ') + '\' stats after all bonuses are applied'"></span>
                                    <span class="badge">{{ deck.value.format(0, 3) }}</span>
                                </li>
                                <li class="list-group-item" v-for="(value, stat) in deck.stats">
                                    {{ stat }}
                                    <span class="badge">{{ value.format(0, 3) }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-rating-input/0.4.0/bootstrap-rating-input.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/vue/2.3.3/vue.js"></script>

<script src="js/helpers.js"></script>
<script src="js/hero.js"></script>
<script src="js/team.js"></script>
<script src="js/team_operations.js"></script>
<script src="js/deck.js"></script>
<script src="js/deck_generator.js"></script>
<script src="js/deck_worker.js"></script>
<script src="js/main.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99018598-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
